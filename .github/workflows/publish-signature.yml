name: Verify and Publish Signature

on:
  push:
    branches:
      - main
    paths:
      - 'commits/signatures/**'

jobs:
  verify-and-publish:
    name: Verificar e Publicar Assinatura
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v3

      - name: Validar estrutura de diret√≥rios
        run: |
          echo "üìÅ Verificando estrutura em commits/signatures..."
          if [ ! -d "commits/signatures" ]; then
            echo "‚ùå Pasta commits/signatures n√£o encontrada!"
            exit 1
          fi

      - name: Verificar arquivos de assinatura
        run: |
          echo "üîç Validando arquivos..."
          find commits/signatures -type f -name "*.txt" | while read file; do
            echo "‚úîÔ∏è Encontrado: $file"
            grep -q "DOCUMENT ID" "$file" || { echo "‚ùå $file inv√°lido: falta DOCUMENT ID"; exit 1; }
            grep -q "USER ID" "$file" || { echo "‚ùå $file inv√°lido: falta USER ID"; exit 1; }
            grep -q "HASH" "$file" || { echo "‚ùå $file inv√°lido: falta HASH"; exit 1; }
            grep -q "SIGNED AT" "$file" || { echo "‚ùå $file inv√°lido: falta SIGNED AT"; exit 1; }
          done

      - name: Log de conclus√£o
        run: |
          echo "‚úÖ Todos os arquivos de assinatura est√£o v√°lidos."